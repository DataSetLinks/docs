openapi: 3.0.3
info:
  title: DataLinks
  version: 1.0.0
security:
  - bearerAuth: [ ]
  - openId: [ implicit ]
  - openId-dev: [ implicit ]
servers:
  - url: /api/v1
paths:
  /user/tokens:
    get:
      description: list all user tokens
      operationId: listTokens
      tags:
        - user
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserTokenResponse'
  /user/token:
    post:
      description: add user token
      operationId: addToken
      tags:
        - user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTokenRequest'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserToken'
  /user/token/{tokenId}:
    delete:
      description: delete user token
      operationId: deleteToken
      tags:
        - user
      parameters:
        - $ref: '#/components/parameters/TokenId'
      responses:
        '200':
          description: Success
  /data:
    get:
      summary: Fetch datasets
      description: Retrieve all available datasets
      operationId: getDatasets
      tags:
        - datasets
      responses:
        '200':
          $ref: '#/components/responses/ListOfDatasets'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /data/{namespace}:
    get:
      summary: Fetch datasets in namespace
      description: Retrieve dataset for a specific namespace.
      operationId: getDatasetsInNamespace
      tags:
        - datasets
      parameters:
        - $ref: '#/components/parameters/Namespace'
      responses:
        '200':
          $ref: '#/components/responses/ListOfDatasets'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /data/{username}/{namespace}/{datasetName}:
    get:
      summary: Get dataset information
      description: Allow to get dataset information
      operationId: getDatasetInformation
      tags:
        - dataset
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      responses:
        '200':
          description: Successful return dataset information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatasetResponse'

        '404':
          description: Dataset not found
        '400':
          description: Bad request
  /data/{username}/{namespace}/{datasetName}/rename:
    post:
      summary: Rename a dataset
      operationId: renameDataset
      tags:
        - dataset
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      requestBody:
        required: true
        content:
          text/plain:
            schema:
              type: string
      responses:
        '200':
          description: Successful rename of a dataset
        '400':
          description: Bad request
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: Dataset not found or not allowed to modify
  /data/{username}/{namespace}/{datasetName}/inferDefinition:
    put:
      summary: Update infer definition
      description: Allow to update saved infer
      operationId: updateInferDefinition
      tags:
        - dataset
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApiInferenceDefinition'
      responses:
        '201':
          description: Successfully created new infer definition
        '404':
          description: Dataset not found or not allowed to modify
        '400':
          description: Bad request
  /schema/{username}/{namespace}/{datasetName}/sort-order:
    put:
      summary: Update dataset sort order
      description: Update the sort order of columns in a dataset
      operationId: updateSortOrder
      tags:
        - dataset
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSortOrderRequest'
      responses:
        '200':
          description: Successfully reordered columns
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Dataset not found or not accessible
        '422':
          $ref: '#/components/responses/UnprocessableContent'
  /data/{username}/{namespace}/{datasetName}/clear:
    post:
      summary: Clear all data for a dataset
      description: Remove all data, links from the specified dataset. This is irreversible.
      operationId: clearDataset
      tags:
        - dataset
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      responses:
        '200':
          description: Dataset data removed successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Dataset not found or not allowed to modify
  /data/{username}/{namespace}/{datasetName}/balefire:
    delete:
      summary: Delete all data and metadata for a dataset (balefire)
      description: Remove all data, links, and metadata for the specified dataset. This is irreversible.
      operationId: balefireDataset
      tags:
        - dataset
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      responses:
        '200':
          description: Dataset and all related data deleted successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Dataset not found or not allowed to modify
  /schema/datasets/all:
    get:
      summary: List all datasets
      description: Retrieve all datasets visible to the authenticated user
      operationId: listAllDatasets
      tags:
        - schema
        - datasets
      responses:
        '200':
          $ref: '#/components/responses/ListOfDatasets'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /schema/{user}/namespaces:
    get:
      summary: List user namespaces
      description: Retrieve namespaces for a specific user (use 'self' for current user)
      operationId: listUserNamespaces
      tags:
        - schema
        - namespaces
      parameters:
        - name: user
          in: path
          required: true
          description: Username or 'self' for current user
          schema:
            type: string
          example: self
      responses:
        '200':
          $ref: '#/components/responses/ListOfNamespaces'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: User not found
  /schema/{user}/{namespace}/datasets:
    get:
      summary: List datasets within namespace
      description: Retrieve datasets within a specific namespace for a user
      operationId: listDatasetsWithinNamespace
      tags:
        - schema
        - datasets
      parameters:
        - name: user
          in: path
          required: true
          description: Username or 'self' for current user
          schema:
            type: string
          example: self
        - $ref: '#/components/parameters/Namespace'
      responses:
        '200':
          $ref: '#/components/responses/ListOfDatasets'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: User or namespace not found
  /ingest/new/{namespace}/{datasetName}:
    post:
      summary: Create new dataset
      description: Creates a new dataset within a specified namespace.
      operationId: createDataset
      tags:
        - ingest
        - datasets
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDatasetRequest'
      responses:
        '201':
          description: Dataset created successfully.
        '401':
          $ref: '#/components/responses/Unauthorized'
  /ingest/{namespace}/{datasetName}:
    post:
      summary: Ingest data
      description: Load data into specified dataset
      operationId: ingestData
      tags:
        - ingest
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestRequest'
            examples:
              movies:
                $ref: '#/components/examples/moviesExample'
              actors:
                $ref: '#/components/examples/actorsExample'
              unstructured:
                $ref: '#/components/examples/unstructuredExample'
      responses:
        '200':
          description: Successful ingestion response.
        '401':
          $ref: '#/components/responses/Unauthorized'
  /infer/preview:
    post:
      summary: Preview
      description: Process data like in ingest but don't save in dataset
      operationId: previewInfer
      tags:
        - ingest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestRequest'
            examples:
              movies:
                $ref: '#/components/examples/moviesExample'
              actors:
                $ref: '#/components/examples/actorsExample'
      responses:
        '200':
          description: Successful preview response with processed data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestPreviewResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /upload/multipart/{username}/{namespace}/{datasetName}/prepare:
    post:
      summary: Prepare multipart upload
      description: Initiate a multipart upload and get presigned URLs for all parts
      operationId: prepareMultipartUpload
      tags:
        - multipart-upload
      parameters:
        - $ref: '#/components/parameters/Username'
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PrepareMultipartRequest'
      responses:
        '200':
          description: Multipart upload prepared successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PrepareMultipartResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          description: Failed to prepare multipart upload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /upload/multipart/{username}/{namespace}/{datasetName}/finish:
    post:
      summary: Finish multipart upload
      description: Finish a multipart upload by providing all part ETags
      operationId: finishMultipartUpload
      tags:
        - multipart-upload
      parameters:
        - $ref: '#/components/parameters/Username'
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FinishedMultipartRequest'
      responses:
        '200':
          description: Multipart upload completed successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          description: Failed to complete multipart upload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /upload/multipart/{username}/{namespace}/{datasetName}/abort:
    post:
      summary: Abort multipart upload
      description: Abort a multipart upload and clean up partial data
      operationId: abortMultipartUpload
      tags:
        - multipart-upload
      parameters:
        - $ref: '#/components/parameters/Username'
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AbortMultipartRequest'
      responses:
        '200':
          description: Multipart upload aborted successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          description: Failed to abort multipart upload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /ontology/{username}/{namespace}/{datasetName}:
    get:
      description: load ontology
      operationId: getConnectedLinks
      tags:
        - ontology
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OntologyResponse'
        '204':
          description: There is no ontology for specified dataset
    post:
      description: save ontology
      operationId: saveConnections
      tags:
        - ontology
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ModifyOntologyRequest'
      responses:
        '200':
          description: Success
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /links/{username}/{namespace}/{datasetName}:
    get:
      summary: Load links
      description: Load links for specified dataset
      operationId: getLinks
      tags:
        - links
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      responses:
        '200':
          description: List of links related to specified dataset.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestLinksResponse'
        '204':
          description: There are no links associated with specified dataset
        '401':
          $ref: '#/components/responses/Unauthorized'
    post:
      summary: "Rebuild links"
      description: "Recalculate links for specified dataset"
      operationId: rebuildLinks
      tags:
        - links
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestLinksRequest'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestLinksResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - User doesn't have access to the dataset
  /links/preview/{username}/{namespace}/{datasetName}:
    post:
      summary: "Preview links"
      description: "Show what recalculate would do"
      operationId: previewLinks
      tags:
        - links
      parameters:
        - $ref: '#/components/parameters/Namespace'
        - $ref: '#/components/parameters/DatasetName'
        - $ref: '#/components/parameters/Username'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/IngestLinksRequest'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IngestLinksResponse'
  /links/add:
    post:
      summary: Add a new link
      description: Create a new link between two dataset columns
      operationId: addLink
      tags:
        - links
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddLinkRequest'
            examples:
              exactMatch:
                summary: Exact match between movie datasets
                value:
                  from:
                    username: "johndoe"
                    namespace: "cinematography"
                    dataset: "movies"
                    columnName: "director"
                  to:
                    username: "janedoe"
                    namespace: "entertainment"
                    dataset: "films"
                    columnName: "director_name"
                  matchType: "ExactMatch"
              geoMatch:
                summary: Geographic match between location datasets
                value:
                  from:
                    username: "alice"
                    namespace: "geography"
                    dataset: "cities"
                    columnName: "coordinates"
                  to:
                    username: "bob"
                    namespace: "mapping"
                    dataset: "locations"
                    columnName: "gps_coords"
                  matchType: "GeoMatch"
      responses:
        '200':
          description: Link existed, no creation required.
        '201':
          description: Link created successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Source or target dataset not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  /query:
    post:
      summary: Query data
      description: Execute ontology query
      operationId: queryData
      tags:
        - query
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/QueryDataRequest'
      responses:
        '200':
          $ref: '#/components/responses/QueryResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /query/autorag:
    post:
      summary: Run AutoRAG agent over all data
      description: Uses the AutoRAG agent to answer a question about any data that the user can access.
      operationId: autorag
      tags:
        - autorag
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AutoRagRequest'
      responses:
        '200':
          $ref: '#/components/responses/AutoRagResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
components:
  parameters:
    DatasetName:
      name: datasetName
      in: path
      required: true
      description: Name of the dataset.
      schema:
        type: string
      examples:
        movies:
          value: "movies"
          summary: "Movies"
        actors:
          value: "actors"
          summary: "Actors"
    Namespace:
      name: namespace
      in: path
      required: true
      description: Namespace for the dataset.
      schema:
        type: string
      example: cinematography
    TokenId:
      name: tokenId
      in: path
      required: true
      description: Token ID
      schema:
        type: string
    Username:
      name: username
      in: path
      required: true
      description: The username associated with the request.
      schema:
        type: string

  schemas:
    DataArray:
      type: array
      description: Array of ontology data objects retrieved from queries.
      items:
        type: object
        additionalProperties: true

    AddLinkRequest:
      type: object
      properties:
        from:
          $ref: '#/components/schemas/ApiStringColumnIdentifier'
          example:
            username: "johndoe"
            namespace: "cinematography"
            dataset: "movies"
            columnName: "director"
        to:
          $ref: '#/components/schemas/ApiStringColumnIdentifier'
          example:
            username: "janedoe"
            namespace: "entertainment"
            dataset: "films"
            columnName: "director_name"
        options:
          type: object
          additionalProperties:
            type: string
          description: Flexible options map for match configuration
        matchType:
          type: string
          description: Type of match to create between the columns
          enum:
            - ExactMatch
            - GeoMatch
          example: "ExactMatch"
      required:
        - from
        - to
        - matchType
    ApiDatasetDescription:
      type: object
      properties:
        name:
          type: string
          description: Dataset name
        namespace:
          type: string
          description: Namespace name
        nameWithNamespace:
          type: string
          description: The name concatenated with the namespace.
          deprecated: true
        owner:
          type: string
          description: The username associated with the data.
        user:
          type: string
          description: The username associated with the data.
          deprecated: true
        visibility:
          type: string
          description: Indicates whether the data is public or private.
          enum:
            - Public
            - Private
      required:
        - owner
        - name
        - namespace
        - visibility
    ApiInferenceDefinition:
      type: object
      properties:
        dataDescription:
          type: string
          description: Data description of the dataset.
          maxLength: 10000
          example: "Employee dataset containing demographics and compensation."
        fieldDefinition:
          type: string
          description: Definition of the dataset fields.
          maxLength: 10000
          example: |
            id=unique employee identifier
            name=full employee name
            age=employee age in years
            department=work department
            salary=annual salary in USD
      required:
        - dataDescription
        - fieldDefinition
    ApiDatasetMetadata:
      type: object
      properties:
        columnNames:
          type: array
          items: { type: string }
          description: List of dataset column names.
          example: [ "id","name","age","department","salary" ]

        inferDefinition:
          description: Inference definition for dataset.
          allOf:
            - $ref: "#/components/schemas/ApiInferenceDefinition"
          example:
            dataDescription: "Employee dataset containing demographics and compensation."
            fieldDefinition: |
              id=unique employee identifier
              name=full employee name
              age=employee age in years
              department=work department
              salary=annual salary in USD

        rowCount:
          type: integer
          format: int64
          description: Number of rows in dataset.
          example: 1250
      required:
        - rowCount
        - columnNames
    ApiLink:
      type: object
      properties:
        destination:
          type: string
          example: "ri.user.examples.companies.other_addresses"
        hits:
          type: integer
          format: int64
          example: 5
        matchType:
          type: string
          example: "ExactMatch"
        origin:
          type: string
          example: "ri.user.examples.companies.nationalities"
      required:
        - destination
        - origin
        - hits
        - matchType
      example:
        destination: "ri.user.examples.actor.name"
        hits: 6
        matchType: "ExactMatch"
        origin: "ri.user.examples.movies.director"
    ApiNamespace:
      type: object
      properties:
        name:
          type: string
          description: The name of the namespace
          example: "cinematography"
        owner:
          type: string
          format: uuid
          description: UUID of the namespace owner
          example: "550e8400-e29b-41d4-a716-446655440000"
      required:
        - name
        - owner
    CreateDatasetRequest:
      type: object
      properties:
        inferDefinition:
          $ref: '#/components/schemas/ApiInferenceDefinition'
        visibility:
          type: string
          enum:
            - Public
            - Private
          example: Private
      required:
        - visibility
    CreateTokenRequest:
      type: object
      properties:
        expires_at:
          type: string
        name:
          type: string
      required:
        - name
    DatasetResponse:
      type: object
      properties:
        dataset:
          $ref: '#/components/schemas/ApiDatasetDescription'
        inferDefinition:
          $ref: '#/components/schemas/ApiInferenceDefinition'
          deprecated: true
          description: "This field is deprecated and will be removed in a future version. Please use `metadata.inferDefinition` instead."
        metadata:
          $ref: '#/components/schemas/ApiDatasetMetadata'
      required:
        - dataset
        - metadata
    ApiStringColumnIdentifier:
      type: object
      properties:
        username:
          type: string
          description: Username who owns the dataset
          example: "johndoe"
        namespace:
          type: string
          description: Namespace of the dataset
          example: "cinematography"
        dataset:
          type: string
          description: Name of the dataset
          example: "movies"
        columnName:
          type: string
          description: Column name in the dataset
          example: "director"
      required:
        - username
        - namespace
        - dataset
        - columnName
      example:
        - username: "username"
        - namespace: "namespace"
        - dataset: "dataset"
        - columnName: "columnName"
    DatasetsResponse:
      type: array
      items:
        $ref: '#/components/schemas/ApiDatasetDescription'
    ErrorResponse:
      type: object
      properties:
        error_code:
          type: string
          example: "UNAUTHORIZED"
        error_message:
          type: string
          example: ""
        message:
          type: string
          example: "Missing authentication token"
        sub_errors:
          type: array
          items:
            type: object
            properties:
              code:
                type: string
              message:
                type: string
            required:
              - message
              - code
      required:
        - message
        - error_code
    IngestLinksResponse:
      type: array
      items:
        $ref: '#/components/schemas/ApiLink'
    IngestLinksRequest:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
        link:
          type: object
          properties:
            ExactMatch:
              type: object
              properties:
                minDistinct:
                  type: number
                minVariation:
                  type: number
              additionalProperties:
                type: string
            GeoMatch:
              type: object
              properties:
                distance:
                  type: number
                distanceUnit:
                  type: string
              additionalProperties:
                type: string
      required:
        - data
        - link
      example:
        data:
          - name: "Braveheart"
            year: "1995"
            budget: "72000000"
            director: "Mel Gibson"
          - name: "Argo"
            year: "2012"
            budget: "44500000"
            director: "Ben Affleck"
        link:
          ExactMatch: null
          GeoMatch: null
    IngestRequest:
      type: object
      properties:
        data:
          type: array
          items:
            type: object
            additionalProperties:
              type: string
        infer:
          type: object
          properties:
            steps:
              type: array
              items:
                oneOf:
                  - $ref: '#/components/schemas/TableStep'
                  - $ref: '#/components/schemas/RowsStep'
                  - $ref: '#/components/schemas/NormaliseStep'
                  - $ref: '#/components/schemas/ValidateStep'
                  - $ref: '#/components/schemas/ReverseGeoStep'
        link:
          type: object
          properties:
            ExactMatch:
              type: string
              nullable: true
              example: null
      required:
        - data
    IngestPreviewResponse:
      type: array
      items:
        type: object
        additionalProperties: true
        description: |
          Each object represents a processed row with dynamic properties based on the inference steps.
          May include metadata fields prefixed with '__metadata_'.
      example:
        - id: "001"
          __metadata_textToTable: "name -> John Smith, age -> 28, department -> Engineering"
          name: "John Smith"
          age: "28"
          gender: "Male"
          department: "Engineering"
          location: "New York"
        - id: "002"
          __metadata_textToTable: "name -> Sarah Johnson, age -> 32, department -> Marketing"
          name: "Sarah Johnson"
          age: "32"
          gender: "Female"
          department: "Marketing"
          location: "California"
        - id: "003"
          name: "Michael Brown"
          age: "45"
          gender: "Male"
          department: "Finance"
          location: "Texas"
          __metadata_normalize: "Normalized department field from 'Fin Dept' to 'Finance'"

    UpdateSortOrderRequest:
      type: object
      properties:
        order:
          type: array
          items:
            type: string
          description: Ordered list of all column names in desired sequence
          example: [ "id", "name", "age", "department", "location" ]
      required:
        - order

    ModifyOntologyRequest:
      type: object
      properties:
        add:
          type: array
          items:
            $ref: '#/components/schemas/ApiLink'
        remove:
          type: array
          items:
            $ref: '#/components/schemas/ApiLink'

    NormaliseStep:
      type: object
      properties:
        type:
          type: string
          enum: [ normalise,normalize ]
        mode:
          type: string
          enum: [ all-in-one, field-by-field, embeddings ]
          description: Normalisation mode
        targetCols:
          type: object
          additionalProperties:
            type: string
          description: Target columns with their descriptions
        helperPrompt:
          type: string
          description: Prompt to help the LLM understand the domain
      required:
        - type
        - mode
        - targetCols

    OntologyResponse:
      type: array
      items:
        $ref: '#/components/schemas/ApiLink'
    OntologyRequest:
      type: string
      example: "OntologyObject(\"objectName\").get()"
      description: for details check [Querying data](/Querying_data)

    QueryDataRequest:
      type: object
      properties:
        username:
          type: string
        namespace:
          type: string
        dataset:
          type: string
        query:
          type: string
          default: ""
        naturalLanguageQuery:
          type: string
        model:
          type: string
        provider:
          type: string
      required:
        - username
        - namespace

    AutoRagRequest:
      type: object
      properties:
        username:
          type: string
        namespace:
          type: string
        query:
          type: string
          example: "What do llamas drink to cool themselves down?"
        model:
          type: string
        provider:
          type: string
      required:
        - username
        - namespace
        - query

    ReverseGeoStep:
      type: object
      properties:
        type:
          type: string
          enum: [ reverseGeo ]
        deriveFrom:
          type: string
          description: Location column name
      required:
        - type
        - deriveFrom

    RowsStep:
      type: object
      properties:
        type:
          type: string
          enum: [ rows ]
        deriveFrom:
          type: string
          description: Column name from where the json content will be read
      required:
        - type
        - deriveFrom

    TableStep:
      type: object
      properties:
        type:
          type: string
          enum: [ table ]
        deriveFrom:
          type: string
          description: Column name from where the column should be derived from
        helperPrompt:
          type: string
          description: Prompt to guide the AI system for higher accuracy during extraction
          example: "This text contains a table comma separated, but instead of line breaks we are using a ';'."
      required:
        - type
        - deriveFrom

    UserToken:
      type: object
      properties:
        created_at:
          type: string
        expires_at:
          type: string
        id:
          type: string
        last_used_at:
          type: string
        name:
          type: string
        token:
          type: string
          nullable: true
      required:
        - id
        - name
        - created_at
        - expires_at
        - token
    UserTokenResponse:
      type: array
      items:
        $ref: '#/components/schemas/UserToken'

    ValidateStep:
      type: object
      properties:
        type:
          type: string
          enum: [ validate ]
        mode:
          type: string
          enum: [ regex, rows, fields ]
          description: Validation mode
        columns:
          type: array
          items:
            type: string
          description: Columns to validate
      required:
        - type
        - mode
        - columns

    PrepareMultipartRequest:
      type: object
      properties:
        filename:
          type: string
          description: 'Name of the file being uploaded'
          example: 'large-data.csv'
        size:
          type: integer
          format: int64
          description: 'Size of the file in bytes'
          example: 73473457
      required:
        - filename
        - size

    PrepareMultipartResponse:
      type: object
      properties:
        uploadId:
          type: string
          description: Unique identifier for the multipart upload session
          example: '2~VmxqYXRlRDZWfjJrRWRiZ2FEQXk3dHI4DGhGLygtTmQNXEZPQXFzMVZOZTUgdEdrXCEyNStkQUp3U3Q2RjJqSkV4MFNBOWxJCk0yIHEkfcQ'
        key:
          type: string
          description: Generated S3 object key
          example: 'uploads/data/20240301-143022-uuid.json'
        partSize:
          type: integer
          format: int64
          description: Size of each part in bytes (8MB)
          example: 8388608
        presignedUrls:
          type: array
          items:
            $ref: "#/components/schemas/PresignedUrlItem"
          description: Array of presigned URLs for multipart upload
          minItems: 1
          maxItems: 10000
      required:
        - uploadId
        - key
        - partSize
        - presignedUrls

    PresignedUrlItem:
      type: object
      properties:
        url:
          type: string
          description: Presigned URL for uploading this part
          example: 'https://my-data-bucket.s3.amazonaws.com/uploads/data/20240301-143022-uuid.json?partNumber=1&uploadId=...'
      required:
        - url

    FinishedMultipartRequest:
      type: object
      properties:
        uploadId:
          type: string
          description: Upload ID from the prepare response
          example: '2~VmxqYXRlRDZWfjJrRWRiZ2FEQXk3dHI4DGhGLygtTmQNXEZPQXFzMVZOZTUgdEdrXCEyNStkQUp3U3Q2RjJqSkV4MFNBOWxJCk0yIHEkfcQ'
        key:
          type: string
          description: S3 object key from the prepare response
          example: 'uploads/data/20240301-143022-uuid.json'
        parts:
          type: array
          items:
            $ref: "#/components/schemas/FinishedMultipartItem"
          description: Array of completed parts with their ETags
          minItems: 1
      required:
        - uploadId
        - key
        - parts

    FinishedMultipartItem:
      type: object
      properties:
        partNumber:
          type: integer
          description: Part number (1-based)
          example: 1
        etag:
          type: string
          description: ETag returned by S3 after uploading the part
          example: 'd41d8cd98f00b204e9800998ecf8427e'
      required:
        - partNumber
        - etag

    AbortMultipartRequest:
      type: object
      properties:
        uploadId:
          type: string
          description: Upload ID to abort
          example: '2~VmxqYXRlRDZWfjJrRWRiZ2FEQXk3dHI4DGhGLygtTmQNXEZPQXFzMVZOZTUgdEdrXCEyNStkQUp3U3Q2RjJqSkV4MFNBOWxJCk0yIHEkfcQ'
        key:
          type: string
          description: S3 object key to abort
          example: 'uploads/data/20240301-143022-uuid.json'
      required:
        - uploadId
        - key

    QueryResponseMetadata:
      type: object
      properties:
        count:
          type: integer
          description: Number of results returned
        executedQuery:
          type: string
          description: The actual query that was executed
        originalQuery:
          type: string
          description: The original query provided by the user
        sourceObject:
          type: string
          description: The source object queried

    QueryResponseData:
      type: object
      properties:
        data:
          $ref: '#/components/schemas/DataArray'
        metadata:
          $ref: '#/components/schemas/QueryResponseMetadata'
      required:
        - data
        - metadata

    AutoRagResponseData:
      type: object
      properties:
        response:
          type: string
          description: Final response generated for the user's question.
        steps:
          type: array
          description: List of steps executed during the AutoRAG process.
          items:
            type: object
            properties:
              instruction:
                type: string
                description: The instruction generated and executed for this step.
              query:
                type: string
                description: The query derived from the instruction.
              data:
                $ref: '#/components/schemas/DataArray'
            required:
              - instruction
              - query
              - data
      required:
        - response
        - steps

  responses:
    QueryResponse:
      description: Successful response with the ontology data object.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/QueryResponseData'

    AutoRagResponse:
      description: Response containing step-by-step RAG execution results and the final answer.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/AutoRagResponseData'

    BadRequest:
      description: Bad request. The request was malformed or invalid.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: Forbidden. User doesn't have access to this resource.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    ListOfDatasets:
      description: Successful response containing data with namespace details.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DatasetsResponse'
    ListOfNamespaces:
      description: Successful response containing list of namespaces accessible to the user.
      content:
        application/json:
          schema:
            type: array
            items:
              $ref: '#/components/schemas/ApiNamespace'
    NotFound:
      description: The requested resource was not found.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: Unauthorized. This error occurs if the authentication token is missing or invalid.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    UnprocessableContent:
      description: Unable to process request.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      description: |
        Use a Bearer token for authentication. Submit the token using the `Authorization`
        header: `Authorization: Bearer <token>`.

    openId-dev:
      type: oauth2
      flows:
        implicit:
          authorizationUrl: https://login.dev.datalinks.com/realms/datalinks-realm/protocol/openid-connect/auth
          scopes:
            openid: openid
    openId:
      type: oauth2
      flows:
        implicit:
          authorizationUrl: https://login.datalinks.com/realms/datalinks-realm/protocol/openid-connect/auth
          scopes:
            openid: openid

  examples:
    moviesExample:
      summary: movies
      value:
        data:
          - name: Braveheart
            year: 1995
            budget: 72000000
            director: Mel Gibson
          - name: Argo
            year: 2012
            budget: 44500000
            director: Ben Affleck
          - name: A Quiet Place
            year: 2018
            budget: 17000000
            director: John Krasinski
          - name: Dances with Wolves
            year: 1990
            budget: 22000000
            director: Kevin Costner
          - name: Unforgiven
            year: 1992
            budget: 14000000
            director: Clint Eastwood
          - name: The Postman
            year: 1997
            budget: 80000000
            director: Kevin Costner
        link:
          ExactMatch: null
    actorsExample:
      summary: actors
      value:
        data:
          # Braveheart
          - name: Mel Gibson
            age: 68
            nationality: American
          - name: Sophie Marceau
            age: 57
            nationality: French

          # Argo
          - name: Ben Affleck
            age: 52
            nationality: American
          - name: Bryan Cranston
            age: 68
            nationality: American

          # A Quiet Place
          - name: John Krasinski
            age: 45
            nationality: American
          - name: Emily Blunt
            age: 41
            nationality: British

          # Dances with Wolves
          - name: Kevin Costner
            age: 69
            nationality: American
          - name: Mary McDonnell
            age: 72
            nationality: American

          # Unforgiven
          - name: Clint Eastwood
            age: 94
            nationality: American
          - name: Morgan Freeman
            age: 86
            nationality: American

          # The Postman
          - name: Kevin Costner
            age: 69
            nationality: American
          - name: Will Patton
            age: 70
            nationality: American

        link:
          ExactMatch: null
    unstructuredExample:
      summary: example of extrtacting row from unstructured data
      value:
        data:
          - text: "Meryl Streep, known for her incredible acting, has starred in unforgettable films like The Devil Wears Prada and Sophie's Choice. She's won three Oscars over her illustrious career. Anne Hathaway shared the screen with her in The Devil Wears Prada and later shone in Les Mis√©rables, earning her own Oscar.\n\nLeonardo DiCaprio, a household name, is celebrated for roles in Titanic, Inception, and The Revenant. His long-awaited Oscar win came for The Revenant. His Titanic co-star Kate Winslet, who also has an Oscar to her name, delivered powerful performances in The Reader and of course, Titanic.\n\nTom Hanks, the quintessential leading man, gave us unforgettable performances in Forrest Gump, Cast Away, and Saving Private Ryan. He's a two-time Oscar winner. Robin Wright, who starred alongside him in Forrest Gump, is also well-remembered for her role in The Princess Bride.\n\nCate Blanchett, a two-time Oscar winner, mesmerized audiences in films like Blue Jasmine, Carol, and Elizabeth. Rooney Mara, her co-star in Carol, also made a mark with her performance in The Girl with the Dragon Tattoo.\n\nDenzel Washington, one of the most respected actors in Hollywood, has won two Oscars for his work in Training Day and Glory. He also delivered a heartfelt performance in Fences, where he starred alongside Viola Davis. Davis herself is a powerhouse of talent, with an Oscar for her role in Fences and another standout performance in The Help."
        infer:
          steps:
            - deriveFrom: text
              helperPrompt: "If you find a numeric field use only the value and omit the rest."
              type: table
